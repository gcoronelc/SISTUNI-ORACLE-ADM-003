    -- TABLE SPACE --
---- Se va crear 1 tablespaces: TBS_MOD (TAMAÑO INICIAL: 150M y autoextendible)  ---

-- VERIFICA SI EXISTE EL TABLESPACE 
DECLARE
	N INT;
	COMMAND VARCHAR2(200);
BEGIN
	COMMAND := 'DROP TABLESPACE TBS_MOD';
	SELECT COUNT(*) INTO N
	FROM V$TABLESPACE WHERE NAME='TBS_MOD';		
	IF ( N = 1 ) THEN
		EXECUTE IMMEDIATE COMMAND;
	END IF;
END;


CREATE TABLESPACE TBS_MOD
DATAFILE 'I:\app\OracleHomeUser1\oradata\orcl\TBS_MOD.DBF'
SIZE 150M
EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO;


-- FIN TABLESAPCE --

-- VERIFICA SI EXISTE EL ROL ADMINISTRADOR_DB
DECLARE
	N INT;
	COMMAND VARCHAR2(200);
BEGIN
	COMMAND := 'DROP ROLE ADMINISTRADOR_DB';
	SELECT COUNT(*) INTO N
	FROM DBA_ROLES WHERE ROLE='ADMINISTRADOR_DB';	
	IF ( N = 1 ) THEN
		EXECUTE IMMEDIATE COMMAND;
	END IF;
END;





-------se altera la session para que oracle 12c acepte script
alter session set "_ORACLE_SCRIPT"=true;

--CREANDO ROLES---
CREATE ROLE ADMINISTRADOR_DB;


-- Asignando permisos al rol ADMINISTRADOR_DB
GRANT CONNECT, RESOURCE TO ADMINISTRADOR_DB;
GRANT CREATE SESSION TO ADMINISTRADOR_DB;
GRANT CREATE ANY TABLE TO ADMINISTRADOR_DB;
GRANT CREATE ROLE TO ADMINISTRADOR_DB;
GRANT CREATE USER TO ADMINISTRADOR_DB;
GRANT CREATE VIEW TO ADMINISTRADOR_DB;
GRANT CREATE ANY INDEX TO ADMINISTRADOR_DB;
GRANT CREATE TRIGGER TO ADMINISTRADOR_DB;
GRANT CREATE PROCEDURE TO ADMINISTRADOR_DB;
GRANT CREATE SEQUENCE TO ADMINISTRADOR_DB;





-- CREAR USUARIO --
-- Verifica si un existe el usuario MOD
DECLARE
	N INT;
	COMMAND VARCHAR2(200);
BEGIN
	COMMAND := 'DROP USER MOD CASCADE';
	SELECT COUNT(*) INTO N
	FROM DBA_USERS
	WHERE USERNAME = 'MOD';
	IF ( N = 1 ) THEN
		EXECUTE IMMEDIATE COMMAND;
	END IF;
END;
/

--Crea el usuario mod 
CREATE USER MOD IDENTIFIED BY MOD2019
DEFAULT TABLESPACE TBS_MOD;

GRANT UNLIMITED TABLESPACE TO MOD;
-- Asignar el rol administrador_bd al usuario MOD
GRANT ADMINISTRADOR_DB TO MOD; 




----REVISAMOS SI ESTA HABILITADO LA AUDITORIA DE LA BD
show parameter aud;





----PARA AUDITAR CREACION Y ELIMINACION DE TABLAS con el usuario MOD 
audit table by MOD by access;

---PARA AUDITAR LAS SESSION CON EL USUARIO MOD
audit session by MOD;

----PARA AUDITAR los SELECT  que se hacen con el usuario MOD
audit select on MOD.TBL_REGISTRO by access;

----PARA DEJAR DE AUDITAR A LA TABLA MOD.TBL_REGISTRO
NOAUDIT all  on MOD.TBL_REGISTRO;

-----PARA VER LA AUDITORIA
select * from aud$;

    
